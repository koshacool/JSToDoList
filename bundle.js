!function(t){var n={};function c(s){if(n[s])return n[s].exports;var l=n[s]={i:s,l:!1,exports:{}};return t[s].call(l.exports,l,l.exports,c),l.l=!0,l.exports}c.m=t,c.c=n,c.d=function(t,n,s){c.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:s})},c.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,n){if(1&n&&(t=c(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(c.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var l in t)c.d(s,l,function(n){return t[n]}.bind(null,l));return s},c.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return c.d(n,"a",n),n},c.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},c.p="",c(c.s=0)}([function(t,n,c){t.exports=c(2)},function(module,exports,__webpack_require__){eval("// extracted by mini-css-extract-plugin//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9zdHlsZXMvaW5kZXguc2Nzcz9iYjY3Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGV4dHJhY3RlZCBieSBtaW5pLWNzcy1leHRyYWN0LXBsdWdpbiJdLCJtYXBwaW5ncyI6IkFBQUEiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///1\n")},function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n\n// CONCATENATED MODULE: ./src/localStorageService.js\nconst TASKS_DB_NAME = 'localstorageTasks';\n\nclass LocalStorageService {\n  constructor () {\n    let tasks = JSON.parse(localStorage.getItem(TASKS_DB_NAME));\n\n    if (!tasks) {\n      tasks = [];\n      localStorage.setItem(TASKS_DB_NAME, JSON.stringify(tasks));\n    }\n\n    this.tasks = tasks;\n  }\n\n  get () {\n    return JSON.parse(localStorage.getItem(TASKS_DB_NAME));\n  }\n\n  set (data) {\n    return localStorage.setItem(TASKS_DB_NAME, JSON.stringify(data));\n  }\n\n  clear () {\n    localStorage.setItem(TASKS_DB_NAME, JSON.stringify([]));\n  }\n}\n\nconst storageService = new LocalStorageService();\n\n/* harmony default export */ var localStorageService = (storageService);\n\n// CONCATENATED MODULE: ./src/utils.js\nconst generateId = () => Math.random().toString(36).substr(2, 9);\n\nconst capitalize = str => str.charAt(0).toUpperCase() + str.slice(1);\n\nconst countActiveTasks = tasks => tasks.reduce(\n  (prev, { status }) => status !== 'completed' ? prev + 1 : prev, 0);\n\nconst debounce = (func, delay = 500) => {\n  let timerId;\n\n  return data => {\n    if (timerId) {\n      clearTimeout(timerId);\n    }\n\n    timerId = setTimeout(() => func(data), delay);\n  };\n};\n\n// CONCATENATED MODULE: ./src/task.js\n\n\n\nconst taskSchema = {\n  id: {\n    type: 'string',\n  },\n\n  title: {\n    type: 'string',\n    isRequired: true,\n  },\n\n  type: {\n    type: 'string',\n    isRequired: true,\n  },\n\n  description: {\n    type: 'string',\n    isRequired: true,\n  },\n\n  status: {\n    type: 'string',\n  },\n};\n\nconst task_TASKS_DB_NAME = 'localstorageTasks';\n\nclass task_Task {\n  constructor ({ id, title, type, description, status = 'opened' }) {\n    this.taskObj = {\n      id: id || generateId(),\n      title,\n      type,\n      description,\n      status,\n    };\n\n    this.saveAction = id ? 'update' : 'create';\n  }\n\n  save () {\n    const tasks = JSON.parse(localStorage.getItem(task_TASKS_DB_NAME));\n    const result = this.validate();\n    const task = { ...this.taskObj };\n\n    if (result.error)  {\n      return result;\n    }\n\n    if (this.saveAction === 'create') {\n      tasks.push(task);    \n    } else {\n      const taskIndex = tasks.findIndex(({ id }) => id === task.id);\n\n      tasks[taskIndex] = task;\n    }\n\n    \n    localStorage.setItem(task_TASKS_DB_NAME, JSON.stringify(tasks));\n\n    return { task };\n  }\n\n  static validateField (name, value) {\n    if (\n      (taskSchema[name].isRequired && !value.trim())\n      || typeof value !== taskSchema[name].type\n    ) {\n      return false;\n    }\n\n    return true;\n  }\n\n  validate () {\n    const validationResult = {\n      notValidFields: {},\n    };\n\n    Object.keys(taskSchema).forEach(fieldName => {\n      const isValid = task_Task.validateField(fieldName, this.taskObj[fieldName]);\n\n      validationResult.notValidFields[fieldName] = isValid;\n\n      if (!isValid) {\n        validationResult.error = true;\n      }\n    });\n\n    return validationResult;\n  }\n}\n\n/* harmony default export */ var src_task = (task_Task);\n\n// CONCATENATED MODULE: ./src/modal.js\n\n\n\nconst ERROR_CLASS_NAME = 'validation-error';\nconst taskTypes = {\n  learning: 'learning',\n  shopping: 'shopping',\n  traveling: 'traveling',\n  sport: 'sport',\n};\n\nclass modal_FormModal {\n  constructor () {\n    this.$rootComponent = null;\n\n    this.initModal = this.initModal.bind(this);\n    this.open = this.open.bind(this);\n    this.close = this.close.bind(this);\n    this.saveForm = this.saveForm.bind(this);\n    this.createTaskForm = this.createTaskForm.bind(this);\n    this.onInputKeyUp = this.onInputKeyUp.bind(this);\n\n    this.initModal();\n    this.initEventListeners();\n  }\n\n  initModal () {\n    const $mainBlock = document.getElementById('app');\n    const $modal = document.createElement('div');\n\n    $modal.className = 'modal';\n    $modal.id = 'form-modal';\n    $modal.innerHTML = `\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <span id=\"modal-close\" class=\"close\">&times;</span>\n          <h2 id=\"modal-title\" class=\"modal-title\">Modal title</h2>\n        </div>\n        <div id=\"modal-body\" class=\"modal-body\"></div>\n        <div class=\"modal-footer\">\n          <button id=\"form-modal-save\" class=\"button\">Save</button>\n        </div>\n      </div>\n  `;\n\n    $mainBlock.appendChild($modal);\n\n    this.$rootComponent = document.getElementById('form-modal');\n  }\n\n  initEventListeners () {\n    const $closeButton = document.getElementById('modal-close');\n    const $saveButton = document.getElementById('form-modal-save');\n\n    $closeButton.addEventListener('click', this.close);\n    $saveButton.addEventListener('click', this.saveForm);\n  }\n\n  createTaskForm ({ id = '', title = '', type = '', description = '', status = '' }) {\n    const $modalBody = document.getElementById('modal-body');\n    const $formBlock = document.createElement('form');\n\n    $formBlock.className = 'task-form';\n    $formBlock.id = 'task-form';\n\n    $formBlock.innerHTML = `\n      <div class=\"form-group\">\n        <label for=\"title\"><i class=\"fa fa-car\"></i> Title</label>\n        <input type=\"text\" class=\"form-input\" id=\"title\" \n          name=\"title\" placeholder=\"Enter title\" value=${title}>\n      </div>\n      <div class=\"form-group\">\n        <label for=\"description\"><i class=\"fa fa-car\"></i> Description</label>\n        <textarea rows=\"4\" cols=\"100\" name=\"description\" form=\"task-form\" \n          name=\"description\" id=\"description\">\n          ${description}\n        </textarea>\n      </div>\n      <div class=\"form-group\">\n        <label for=\"type\"><i class=\"fa fa-car\"></i> Task Type</label>\n        <select class=\"form-control\" id=\"type\" name=\"type\" value=${type}>\n          <option selected=${taskTypes.learning === type} value=${taskTypes.learning}>\n            ${taskTypes.learning}\n           </option>\n          <option selected=${taskTypes.shopping === type} value=${taskTypes.shopping}>\n            ${taskTypes.shopping}\n          </option>\n          <option selected=${taskTypes.traveling === type} value=${taskTypes.traveling}>\n            ${taskTypes.traveling}\n          </option>\n          <option selected=${taskTypes.sport === type} value=${taskTypes.sport}>\n            ${taskTypes.sport}\n          </option>\n        </select>\n       </div>\n    `;\n\n    if (id) {\n      const $idInput = document.createElement('input');\n\n      $idInput.type = 'hidden';\n      $idInput.className = 'task-id';\n      $idInput.setAttribute('value', id);\n      $idInput.setAttribute('name', 'id');\n\n      $formBlock.appendChild($idInput);\n    }\n\n    if (status) {\n      const $statusInput = document.createElement('input');\n\n      $statusInput.type = 'hidden';\n      $statusInput.className = 'task-status';\n      $statusInput.setAttribute('value', status);\n      $statusInput.setAttribute('name', 'status');\n\n      $formBlock.appendChild($statusInput);\n    }\n\n    if ($modalBody.hasChildNodes()) {\n      $modalBody.firstChild.replaceWith($formBlock);\n    } else {\n      $modalBody.appendChild($formBlock);\n    }\n\n    const formInputs = document.getElementById('task-form').elements;\n\n    for (let i = 0; i < formInputs.length; i++) {\n      formInputs[i].addEventListener('keyup', this.onInputKeyUp);\n    }\n  }\n\n  open (callback,  data = {}) {\n    this.callback = callback;\n    const $modalTitle = document.getElementById('modal-title');\n\n    if (data.id) {\n      $modalTitle.innerHTML = 'Edit Task';\n    } else {\n      $modalTitle.innerHTML = 'Create Task';\n    }\n\n    this.createTaskForm(data);\n\n    this.$rootComponent.style.display = 'block';\n  }\n\n  close () {\n    this.callback = null;\n    this.$rootComponent.style.display = 'none';\n  }\n\n  saveForm () {\n    const taskData = {};\n    const formInputs = document.getElementById('task-form').elements;\n\n    for (let i = 0; i < formInputs.length; i++) {\n      const { name, value } = formInputs[i];\n      taskData[name] = value;\n    }\n\n    const task = new src_task(taskData);\n    const { error, notValidFields, task: newTask } = task.save();\n\n    if (!error) {\n      this.callback && this.callback(newTask);\n      this.close();\n    } else {\n      for (let i = 0; i < formInputs.length; i++) {\n        const { name } = formInputs[i];\n\n        this.highlightInput(formInputs[i], notValidFields[name]);\n      }\n    }\n  }\n\n  onInputKeyUp ({ target }) {\n    const { name, value } = target;\n    const isValid = src_task.validateField(name, value);\n\n    this.highlightInput(target, isValid);\n  }\n\n  highlightInput ($input, isValid) {\n    if (!isValid) {\n      $input.className = `${$input.className} ${ERROR_CLASS_NAME}`;\n      return;\n    }\n\n    $input.classList.remove(ERROR_CLASS_NAME);\n  }\n\n}\n\nconst modalController = new modal_FormModal();\n\n/* harmony default export */ var modal = (modalController);\n\n// CONCATENATED MODULE: ./src/main.js\n\n\n\n\n\nconst mainActionsBlockId = 'main-page__actions';\nconst addButtonClass = 'add-task';\nconst finishAllButtonClass = 'finish-all-tasks';\nconst removeAllButtonClass = 'remove-all-tasks';\n\n// Filters buttons\nconst taskTypeSelectId = 'filters__task-type';\nconst inputFilterId = 'filters__search';\nconst filterButtonsBlockId = 'filters__buttons';\nconst filterButtonsClasses = {\n  all: 'all',\n  opened: 'opened',\n  completed: 'completed',\n};\n\nconst listBlockId = 'tasks-list';\n\nclass main_TaskList {\n  constructor (tasks) {\n    this.tasks = tasks;\n\n    this.filtersState = {\n      status: filterButtonsClasses.all,\n      type: 'all',\n      text: '',\n    };\n\n    this.initCommonStructure();\n\n    this.$mainActionsBlock = document.getElementById(mainActionsBlockId);\n    this.$taskTypeSelect = document.getElementById(taskTypeSelectId);\n    this.$inputFilter = document.getElementById(inputFilterId);\n    this.$filterButtonsBlock = document.getElementById(filterButtonsBlockId);\n    this.$listBlock = document.getElementById(listBlockId);\n    this.$taskCount = document.getElementById('tasks-count');\n\n    this.onClickFilterButtons = this.onClickFilterButtons.bind(this);\n    this.onChangeType = this.onChangeType.bind(this);\n    this.onInput = this.onInput.bind(this);\n    this.renderTasks = this.renderTasks.bind(this);\n    this.onTaskChange = this.onTaskChange.bind(this);\n    this.onCreateTask = this.onCreateTask.bind(this);\n\n    this.onEditTask = this.onEditTask.bind(this);\n    this.onClickMainActions = this.onClickMainActions.bind(this);\n    this.onClickFilterButtons = this.onClickFilterButtons.bind(this);\n\n    this.renderTasks(this.tasks);\n    this.initEventListeners();\n  }\n\n  initCommonStructure () {\n    const { status } = this.filtersState;\n    const $mainBlock = document.getElementById('app');\n    const $taskList = document.createElement('div');\n\n    $taskList.className = 'task-list-container';\n    $taskList.id = 'task-list-container';\n    $taskList.innerHTML = `\n      <div id=${mainActionsBlockId} class=${mainActionsBlockId}>\n\t\t<button class=\"button ${addButtonClass}\">Add</button>\n\t\t<button class=\"button ${finishAllButtonClass}\">Finish all</button>\n\t\t<button class=\"button ${removeAllButtonClass}\">Remove all</button>\n\t</div>\n\n\t<div class=\"filters\">\n\t\t<div class=\"filters__types\">\n\t\t\t<select class=\"task-types\" id=${taskTypeSelectId} name=\"type\">\n          <option value=\"all\">\n            all\n          </option>\n          <option value=\"learning\">\n          \tlearning\n          </option>\n          <option value=\"shopping\">\n            shopping\n          </option>\n          <option value=\"traveling\">\n            traveling\n          </option>\n          <option value=\"sport\">\n            sport\n          </option>\n        </select>\n        \t<span id=\"tasks-count\" class=\"tasks-count\">${this.tasks.length} Tasks left</span>\n\t\t</div>\n\n\t\t<div id=${filterButtonsBlockId} class=${filterButtonsBlockId}>\n\t\t\t<button class=\"button ${filterButtonsClasses.all} \n          ${status === filterButtonsClasses.all ? 'active' : ''}\"\n      >All</button>\n\t\t\t<button class=\"button ${filterButtonsClasses.opened} \n          ${status === filterButtonsClasses.opened ? 'active' : ''}\"\n      >Opened</button>\n\t\t\t<button class=\"button ${filterButtonsClasses.completed} \n        ${status === filterButtonsClasses.completed ? 'active' : ''}\"\n      >Completed</button>\n\t\t</div>\n\t</div>\n\n\t<input class=\"search\" placeholder=\"search\" id=${inputFilterId}>\n\n\t<div class=${listBlockId} id=${listBlockId}>\n\t\n  </div>\n  `;\n\n    $mainBlock.appendChild($taskList);\n  }\n\n  initEventListeners () {\n    this.$mainActionsBlock.addEventListener('click', this.onClickMainActions);\n    this.$filterButtonsBlock.addEventListener('click',\n      this.onClickFilterButtons);\n    this.$taskTypeSelect.addEventListener('change', this.onChangeType);\n    this.$inputFilter.addEventListener('keyup', debounce(this.onInput));\n    this.$listBlock.addEventListener('click', this.onTaskChange);\n  }\n\n  createTaskElement ({ id, title, description, status }) {\n    const $taskItem = document.createElement('div');\n    $taskItem.classList.add('task-item', status);\n    $taskItem.id = id;\n\n    const $checkboxBlock = document.createElement('label');\n    $checkboxBlock.className = 'checkbox-container';\n    const $checkbox = document.createElement('input');\n    $checkbox.setAttribute('type', 'checkbox');\n    status === filterButtonsClasses.completed && $checkbox.setAttribute('checked', true);\n    const $span = document.createElement('span');\n    $span.className = 'checkmark';\n    $checkboxBlock.appendChild($checkbox);\n    $checkboxBlock.appendChild($span);\n\n    const $textBlock = document.createElement('div');\n    $textBlock.classList.add('task-text');\n    $textBlock.innerHTML = `\n        <div class=\"task-text__title\">${capitalize(title)}</div>\n        <div class=\"task-text__description\">${capitalize(description)}</div>  \n      `;\n\n    const $actionsBlock = document.createElement('div');\n    $actionsBlock.className = 'task-actions';\n    $actionsBlock.innerHTML = `\n        <i class=\"fa fa-pencil task-actions__button task-actions__edit\"></i>\n        <i class=\"fa fa-trash task-actions__button task-actions__remove\"></i> \n      `;\n\n    $taskItem.appendChild($checkboxBlock);\n    $taskItem.appendChild($textBlock);\n    $taskItem.appendChild($actionsBlock);\n\n    return $taskItem;\n  }\n\n  renderTasks () {\n    const { status, type, text } = this.filtersState;\n    const tasks = this.tasks.filter(task => {\n      if (\n        (status !== 'all' && task.status !== status)\n        || (type !== 'all' && task.type !== type)\n        || (text && task.title.toLowerCase().indexOf(text.toLowerCase()) === -1\n          && task.description.toLowerCase().indexOf(text.toLowerCase()) === -1)\n      ) {\n        return false;\n      }\n\n      return true;\n    });\n\n    this.$taskCount.innerHTML = `${countActiveTasks(tasks)} Tasks left`;\n\n    if (tasks.length) {\n      tasks.forEach(taskObj => {\n        const $taskItem = this.createTaskElement(taskObj);\n        this.$listBlock.appendChild($taskItem);\n      });\n    } else {\n      const $noTasks = document.createElement('h2');\n      $noTasks.innerHTML = 'You haven\\'t any tasks.';\n      $noTasks.className = 'no-tasks';\n\n      this.$listBlock.appendChild($noTasks);\n    }\n  }\n\n  onClickMainActions ({ target }) {\n    const isButton = target.classList.contains('button');\n\n    if (isButton) {\n      if (target.classList.contains(addButtonClass)) {\n        modal.open(this.onCreateTask);\n      }\n\n      if (target.classList.contains(finishAllButtonClass)) {\n        const finishedTasks = this.tasks.map(task => ({\n          ...task,\n          status: filterButtonsClasses.completed,\n        }));\n\n        localStorageService.set(finishedTasks);\n        this.tasks = finishedTasks;\n        this.$listBlock.innerHTML = '';\n        this.renderTasks();\n      }\n\n      if (target.classList.contains(removeAllButtonClass)) {\n        localStorageService.clear();\n        this.tasks = [];\n        this.$listBlock.innerHTML = '';\n        this.renderTasks();\n      }\n    }\n  }\n\n  onCreateTask (task) {\n    this.$listBlock.innerHTML = '';\n    this.tasks.push(task);\n    this.renderTasks();\n  }\n\n  onEditTask ($task) {\n    return task => {\n      const $newTask = this.createTaskElement(task);\n\n      this.tasks.push(task);\n      this.$listBlock.replaceChild($newTask, $task);\n    };\n  }\n\n  onClickFilterButtons ({ target }) {\n    const rerenderTasks = filterValue => {\n      this.filtersState.status = filterValue;\n      this.$listBlock.innerHTML = '';\n      this.renderTasks();\n    };\n    const isButton = target.classList.contains('button');\n    const isClickedActiveFilter = target.classList\n      .contains(this.filtersState.button);\n\n\n    if (isButton && !isClickedActiveFilter) {\n      const $prevActiveFilter = [].find.call(\n        target.parentElement.children,\n        elem => elem.classList.contains('active')\n      );\n      const filterValue = Object.keys(filterButtonsClasses)\n        .find(value => target.classList.contains(value));\n\n      $prevActiveFilter.classList.remove('active');\n      target.classList.add('active');\n\n      filterValue && rerenderTasks(filterValue);\n    }\n  }\n\n  onChangeType ({ target: { value } }) {\n    this.filtersState.type = value;\n    this.$listBlock.innerHTML = '';\n    this.renderTasks();\n  }\n\n  updateFilters (name, value) {\n    this.filtersState[name] = value;\n    this.$listBlock.innerHTML = '';\n    this.renderTasks();\n  }\n\n  onInput ({ target }) {\n    const value = target.value.trim();\n    this.updateFilters('text', value);\n  }\n\n  onTaskChange  ({ target })  {\n    const { tasks } = this;\n    const $task = target.parentElement.parentElement;\n    const taskId = $task.id;\n    const taskActions = {\n      remove: {\n        isCurrent: target.classList.contains('task-actions__remove'),\n        run: () => {\n          const newTasks = tasks.filter(({ id }) => id !== taskId);\n\n          localStorageService.set(newTasks);\n          this.tasks = newTasks;\n          this.$listBlock.removeChild($task);\n        }\n      },\n      edit: {\n        isCurrent: target.classList.contains('task-actions__edit'),\n        run: () => {\n          const taskObj = tasks.find(({ id }) => id === taskId);\n\n          modal.open(this.onEditTask($task), taskObj);\n        }\n      },\n      changeStatus: {\n        isCurrent: target.type === 'checkbox',\n        run: () => {\n          const isChecked = target.checked;\n          const taskIndex = tasks.findIndex(({ id }) => id === taskId);\n          const task = this.tasks[taskIndex];\n\n          if (isChecked) {\n            task.status = filterButtonsClasses.completed;\n            $task.classList.add(filterButtonsClasses.completed);\n            $task.classList.remove(filterButtonsClasses.opened);\n          } else {\n            task.status = filterButtonsClasses.opened;\n            $task.classList.remove(filterButtonsClasses.completed);\n            $task.classList.add(filterButtonsClasses.opened);\n          }\n\n          this.tasks[taskIndex] = task;\n          localStorageService.set(this.tasks);\n        }\n      },\n    };\n    const action = Object.values(taskActions).find(({ isCurrent }) => isCurrent);\n\n    if (action) {\n      action.run();\n    }\n  }\n}\n\n/* harmony default export */ var main = (main_TaskList);\n\n// EXTERNAL MODULE: ./src/styles/index.scss\nvar styles = __webpack_require__(1);\n\n// CONCATENATED MODULE: ./src/index.js\n\n\n\n\n\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  const tasks = localStorageService.get();\n\n  new main(tasks);\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9sb2NhbFN0b3JhZ2VTZXJ2aWNlLmpzP2YxNjMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3V0aWxzLmpzPzAyNWUiLCJ3ZWJwYWNrOi8vLy4vc3JjL3Rhc2suanM/N2MxMSIsIndlYnBhY2s6Ly8vLi9zcmMvbW9kYWwuanM/YmYyMSIsIndlYnBhY2s6Ly8vLi9zcmMvbWFpbi5qcz81NmQ3Iiwid2VicGFjazovLy8uL3NyYy9pbmRleC5qcz9iNjM1Il0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFRBU0tTX0RCX05BTUUgPSAnbG9jYWxzdG9yYWdlVGFza3MnO1xuXG5jbGFzcyBMb2NhbFN0b3JhZ2VTZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IgKCkge1xuICAgIGxldCB0YXNrcyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oVEFTS1NfREJfTkFNRSkpO1xuXG4gICAgaWYgKCF0YXNrcykge1xuICAgICAgdGFza3MgPSBbXTtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFRBU0tTX0RCX05BTUUsIEpTT04uc3RyaW5naWZ5KHRhc2tzKSk7XG4gICAgfVxuXG4gICAgdGhpcy50YXNrcyA9IHRhc2tzO1xuICB9XG5cbiAgZ2V0ICgpIHtcbiAgICByZXR1cm4gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShUQVNLU19EQl9OQU1FKSk7XG4gIH1cblxuICBzZXQgKGRhdGEpIHtcbiAgICByZXR1cm4gbG9jYWxTdG9yYWdlLnNldEl0ZW0oVEFTS1NfREJfTkFNRSwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICB9XG5cbiAgY2xlYXIgKCkge1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFRBU0tTX0RCX05BTUUsIEpTT04uc3RyaW5naWZ5KFtdKSk7XG4gIH1cbn1cblxuY29uc3Qgc3RvcmFnZVNlcnZpY2UgPSBuZXcgTG9jYWxTdG9yYWdlU2VydmljZSgpO1xuXG5leHBvcnQgZGVmYXVsdCBzdG9yYWdlU2VydmljZTtcbiIsImV4cG9ydCBjb25zdCBnZW5lcmF0ZUlkID0gKCkgPT4gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpO1xuXG5leHBvcnQgY29uc3QgY2FwaXRhbGl6ZSA9IHN0ciA9PiBzdHIuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBzdHIuc2xpY2UoMSk7XG5cbmV4cG9ydCBjb25zdCBjb3VudEFjdGl2ZVRhc2tzID0gdGFza3MgPT4gdGFza3MucmVkdWNlKFxuICAocHJldiwgeyBzdGF0dXMgfSkgPT4gc3RhdHVzICE9PSAnY29tcGxldGVkJyA/IHByZXYgKyAxIDogcHJldiwgMCk7XG5cbmV4cG9ydCBjb25zdCBkZWJvdW5jZSA9IChmdW5jLCBkZWxheSA9IDUwMCkgPT4ge1xuICBsZXQgdGltZXJJZDtcblxuICByZXR1cm4gZGF0YSA9PiB7XG4gICAgaWYgKHRpbWVySWQpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lcklkKTtcbiAgICB9XG5cbiAgICB0aW1lcklkID0gc2V0VGltZW91dCgoKSA9PiBmdW5jKGRhdGEpLCBkZWxheSk7XG4gIH07XG59O1xuIiwiaW1wb3J0IHsgZ2VuZXJhdGVJZCB9IGZyb20gJy4vdXRpbHMnO1xuXG5cbmNvbnN0IHRhc2tTY2hlbWEgPSB7XG4gIGlkOiB7XG4gICAgdHlwZTogJ3N0cmluZycsXG4gIH0sXG5cbiAgdGl0bGU6IHtcbiAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICBpc1JlcXVpcmVkOiB0cnVlLFxuICB9LFxuXG4gIHR5cGU6IHtcbiAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICBpc1JlcXVpcmVkOiB0cnVlLFxuICB9LFxuXG4gIGRlc2NyaXB0aW9uOiB7XG4gICAgdHlwZTogJ3N0cmluZycsXG4gICAgaXNSZXF1aXJlZDogdHJ1ZSxcbiAgfSxcblxuICBzdGF0dXM6IHtcbiAgICB0eXBlOiAnc3RyaW5nJyxcbiAgfSxcbn07XG5cbmNvbnN0IFRBU0tTX0RCX05BTUUgPSAnbG9jYWxzdG9yYWdlVGFza3MnO1xuXG5jbGFzcyBUYXNrIHtcbiAgY29uc3RydWN0b3IgKHsgaWQsIHRpdGxlLCB0eXBlLCBkZXNjcmlwdGlvbiwgc3RhdHVzID0gJ29wZW5lZCcgfSkge1xuICAgIHRoaXMudGFza09iaiA9IHtcbiAgICAgIGlkOiBpZCB8fCBnZW5lcmF0ZUlkKCksXG4gICAgICB0aXRsZSxcbiAgICAgIHR5cGUsXG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIHN0YXR1cyxcbiAgICB9O1xuXG4gICAgdGhpcy5zYXZlQWN0aW9uID0gaWQgPyAndXBkYXRlJyA6ICdjcmVhdGUnO1xuICB9XG5cbiAgc2F2ZSAoKSB7XG4gICAgY29uc3QgdGFza3MgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFRBU0tTX0RCX05BTUUpKTtcbiAgICBjb25zdCByZXN1bHQgPSB0aGlzLnZhbGlkYXRlKCk7XG4gICAgY29uc3QgdGFzayA9IHsgLi4udGhpcy50YXNrT2JqIH07XG5cbiAgICBpZiAocmVzdWx0LmVycm9yKSAge1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zYXZlQWN0aW9uID09PSAnY3JlYXRlJykge1xuICAgICAgdGFza3MucHVzaCh0YXNrKTsgICAgXG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHRhc2tJbmRleCA9IHRhc2tzLmZpbmRJbmRleCgoeyBpZCB9KSA9PiBpZCA9PT0gdGFzay5pZCk7XG5cbiAgICAgIHRhc2tzW3Rhc2tJbmRleF0gPSB0YXNrO1xuICAgIH1cblxuICAgIFxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFRBU0tTX0RCX05BTUUsIEpTT04uc3RyaW5naWZ5KHRhc2tzKSk7XG5cbiAgICByZXR1cm4geyB0YXNrIH07XG4gIH1cblxuICBzdGF0aWMgdmFsaWRhdGVGaWVsZCAobmFtZSwgdmFsdWUpIHtcbiAgICBpZiAoXG4gICAgICAodGFza1NjaGVtYVtuYW1lXS5pc1JlcXVpcmVkICYmICF2YWx1ZS50cmltKCkpXG4gICAgICB8fCB0eXBlb2YgdmFsdWUgIT09IHRhc2tTY2hlbWFbbmFtZV0udHlwZVxuICAgICkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgdmFsaWRhdGUgKCkge1xuICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSB7XG4gICAgICBub3RWYWxpZEZpZWxkczoge30sXG4gICAgfTtcblxuICAgIE9iamVjdC5rZXlzKHRhc2tTY2hlbWEpLmZvckVhY2goZmllbGROYW1lID0+IHtcbiAgICAgIGNvbnN0IGlzVmFsaWQgPSBUYXNrLnZhbGlkYXRlRmllbGQoZmllbGROYW1lLCB0aGlzLnRhc2tPYmpbZmllbGROYW1lXSk7XG5cbiAgICAgIHZhbGlkYXRpb25SZXN1bHQubm90VmFsaWRGaWVsZHNbZmllbGROYW1lXSA9IGlzVmFsaWQ7XG5cbiAgICAgIGlmICghaXNWYWxpZCkge1xuICAgICAgICB2YWxpZGF0aW9uUmVzdWx0LmVycm9yID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiB2YWxpZGF0aW9uUmVzdWx0O1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFRhc2s7XG4iLCJpbXBvcnQgVGFzayBmcm9tICcuL3Rhc2snO1xuXG5cbmNvbnN0IEVSUk9SX0NMQVNTX05BTUUgPSAndmFsaWRhdGlvbi1lcnJvcic7XG5jb25zdCB0YXNrVHlwZXMgPSB7XG4gIGxlYXJuaW5nOiAnbGVhcm5pbmcnLFxuICBzaG9wcGluZzogJ3Nob3BwaW5nJyxcbiAgdHJhdmVsaW5nOiAndHJhdmVsaW5nJyxcbiAgc3BvcnQ6ICdzcG9ydCcsXG59O1xuXG5jbGFzcyBGb3JtTW9kYWwge1xuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgdGhpcy4kcm9vdENvbXBvbmVudCA9IG51bGw7XG5cbiAgICB0aGlzLmluaXRNb2RhbCA9IHRoaXMuaW5pdE1vZGFsLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vcGVuID0gdGhpcy5vcGVuLmJpbmQodGhpcyk7XG4gICAgdGhpcy5jbG9zZSA9IHRoaXMuY2xvc2UuYmluZCh0aGlzKTtcbiAgICB0aGlzLnNhdmVGb3JtID0gdGhpcy5zYXZlRm9ybS5iaW5kKHRoaXMpO1xuICAgIHRoaXMuY3JlYXRlVGFza0Zvcm0gPSB0aGlzLmNyZWF0ZVRhc2tGb3JtLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vbklucHV0S2V5VXAgPSB0aGlzLm9uSW5wdXRLZXlVcC5iaW5kKHRoaXMpO1xuXG4gICAgdGhpcy5pbml0TW9kYWwoKTtcbiAgICB0aGlzLmluaXRFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgaW5pdE1vZGFsICgpIHtcbiAgICBjb25zdCAkbWFpbkJsb2NrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwcCcpO1xuICAgIGNvbnN0ICRtb2RhbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXG4gICAgJG1vZGFsLmNsYXNzTmFtZSA9ICdtb2RhbCc7XG4gICAgJG1vZGFsLmlkID0gJ2Zvcm0tbW9kYWwnO1xuICAgICRtb2RhbC5pbm5lckhUTUwgPSBgXG4gICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtY29udGVudFwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtaGVhZGVyXCI+XG4gICAgICAgICAgPHNwYW4gaWQ9XCJtb2RhbC1jbG9zZVwiIGNsYXNzPVwiY2xvc2VcIj4mdGltZXM7PC9zcGFuPlxuICAgICAgICAgIDxoMiBpZD1cIm1vZGFsLXRpdGxlXCIgY2xhc3M9XCJtb2RhbC10aXRsZVwiPk1vZGFsIHRpdGxlPC9oMj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgaWQ9XCJtb2RhbC1ib2R5XCIgY2xhc3M9XCJtb2RhbC1ib2R5XCI+PC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1mb290ZXJcIj5cbiAgICAgICAgICA8YnV0dG9uIGlkPVwiZm9ybS1tb2RhbC1zYXZlXCIgY2xhc3M9XCJidXR0b25cIj5TYXZlPC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gIGA7XG5cbiAgICAkbWFpbkJsb2NrLmFwcGVuZENoaWxkKCRtb2RhbCk7XG5cbiAgICB0aGlzLiRyb290Q29tcG9uZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zvcm0tbW9kYWwnKTtcbiAgfVxuXG4gIGluaXRFdmVudExpc3RlbmVycyAoKSB7XG4gICAgY29uc3QgJGNsb3NlQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLWNsb3NlJyk7XG4gICAgY29uc3QgJHNhdmVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9ybS1tb2RhbC1zYXZlJyk7XG5cbiAgICAkY2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmNsb3NlKTtcbiAgICAkc2F2ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuc2F2ZUZvcm0pO1xuICB9XG5cbiAgY3JlYXRlVGFza0Zvcm0gKHsgaWQgPSAnJywgdGl0bGUgPSAnJywgdHlwZSA9ICcnLCBkZXNjcmlwdGlvbiA9ICcnLCBzdGF0dXMgPSAnJyB9KSB7XG4gICAgY29uc3QgJG1vZGFsQm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1ib2R5Jyk7XG4gICAgY29uc3QgJGZvcm1CbG9jayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zvcm0nKTtcblxuICAgICRmb3JtQmxvY2suY2xhc3NOYW1lID0gJ3Rhc2stZm9ybSc7XG4gICAgJGZvcm1CbG9jay5pZCA9ICd0YXNrLWZvcm0nO1xuXG4gICAgJGZvcm1CbG9jay5pbm5lckhUTUwgPSBgXG4gICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICA8bGFiZWwgZm9yPVwidGl0bGVcIj48aSBjbGFzcz1cImZhIGZhLWNhclwiPjwvaT4gVGl0bGU8L2xhYmVsPlxuICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cImZvcm0taW5wdXRcIiBpZD1cInRpdGxlXCIgXG4gICAgICAgICAgbmFtZT1cInRpdGxlXCIgcGxhY2Vob2xkZXI9XCJFbnRlciB0aXRsZVwiIHZhbHVlPSR7dGl0bGV9PlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICA8bGFiZWwgZm9yPVwiZGVzY3JpcHRpb25cIj48aSBjbGFzcz1cImZhIGZhLWNhclwiPjwvaT4gRGVzY3JpcHRpb248L2xhYmVsPlxuICAgICAgICA8dGV4dGFyZWEgcm93cz1cIjRcIiBjb2xzPVwiMTAwXCIgbmFtZT1cImRlc2NyaXB0aW9uXCIgZm9ybT1cInRhc2stZm9ybVwiIFxuICAgICAgICAgIG5hbWU9XCJkZXNjcmlwdGlvblwiIGlkPVwiZGVzY3JpcHRpb25cIj5cbiAgICAgICAgICAke2Rlc2NyaXB0aW9ufVxuICAgICAgICA8L3RleHRhcmVhPlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICA8bGFiZWwgZm9yPVwidHlwZVwiPjxpIGNsYXNzPVwiZmEgZmEtY2FyXCI+PC9pPiBUYXNrIFR5cGU8L2xhYmVsPlxuICAgICAgICA8c2VsZWN0IGNsYXNzPVwiZm9ybS1jb250cm9sXCIgaWQ9XCJ0eXBlXCIgbmFtZT1cInR5cGVcIiB2YWx1ZT0ke3R5cGV9PlxuICAgICAgICAgIDxvcHRpb24gc2VsZWN0ZWQ9JHt0YXNrVHlwZXMubGVhcm5pbmcgPT09IHR5cGV9IHZhbHVlPSR7dGFza1R5cGVzLmxlYXJuaW5nfT5cbiAgICAgICAgICAgICR7dGFza1R5cGVzLmxlYXJuaW5nfVxuICAgICAgICAgICA8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHNlbGVjdGVkPSR7dGFza1R5cGVzLnNob3BwaW5nID09PSB0eXBlfSB2YWx1ZT0ke3Rhc2tUeXBlcy5zaG9wcGluZ30+XG4gICAgICAgICAgICAke3Rhc2tUeXBlcy5zaG9wcGluZ31cbiAgICAgICAgICA8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHNlbGVjdGVkPSR7dGFza1R5cGVzLnRyYXZlbGluZyA9PT0gdHlwZX0gdmFsdWU9JHt0YXNrVHlwZXMudHJhdmVsaW5nfT5cbiAgICAgICAgICAgICR7dGFza1R5cGVzLnRyYXZlbGluZ31cbiAgICAgICAgICA8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHNlbGVjdGVkPSR7dGFza1R5cGVzLnNwb3J0ID09PSB0eXBlfSB2YWx1ZT0ke3Rhc2tUeXBlcy5zcG9ydH0+XG4gICAgICAgICAgICAke3Rhc2tUeXBlcy5zcG9ydH1cbiAgICAgICAgICA8L29wdGlvbj5cbiAgICAgICAgPC9zZWxlY3Q+XG4gICAgICAgPC9kaXY+XG4gICAgYDtcblxuICAgIGlmIChpZCkge1xuICAgICAgY29uc3QgJGlkSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuXG4gICAgICAkaWRJbnB1dC50eXBlID0gJ2hpZGRlbic7XG4gICAgICAkaWRJbnB1dC5jbGFzc05hbWUgPSAndGFzay1pZCc7XG4gICAgICAkaWRJbnB1dC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgaWQpO1xuICAgICAgJGlkSW5wdXQuc2V0QXR0cmlidXRlKCduYW1lJywgJ2lkJyk7XG5cbiAgICAgICRmb3JtQmxvY2suYXBwZW5kQ2hpbGQoJGlkSW5wdXQpO1xuICAgIH1cblxuICAgIGlmIChzdGF0dXMpIHtcbiAgICAgIGNvbnN0ICRzdGF0dXNJbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG5cbiAgICAgICRzdGF0dXNJbnB1dC50eXBlID0gJ2hpZGRlbic7XG4gICAgICAkc3RhdHVzSW5wdXQuY2xhc3NOYW1lID0gJ3Rhc2stc3RhdHVzJztcbiAgICAgICRzdGF0dXNJbnB1dC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgc3RhdHVzKTtcbiAgICAgICRzdGF0dXNJbnB1dC5zZXRBdHRyaWJ1dGUoJ25hbWUnLCAnc3RhdHVzJyk7XG5cbiAgICAgICRmb3JtQmxvY2suYXBwZW5kQ2hpbGQoJHN0YXR1c0lucHV0KTtcbiAgICB9XG5cbiAgICBpZiAoJG1vZGFsQm9keS5oYXNDaGlsZE5vZGVzKCkpIHtcbiAgICAgICRtb2RhbEJvZHkuZmlyc3RDaGlsZC5yZXBsYWNlV2l0aCgkZm9ybUJsb2NrKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJG1vZGFsQm9keS5hcHBlbmRDaGlsZCgkZm9ybUJsb2NrKTtcbiAgICB9XG5cbiAgICBjb25zdCBmb3JtSW5wdXRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rhc2stZm9ybScpLmVsZW1lbnRzO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmb3JtSW5wdXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBmb3JtSW5wdXRzW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5vbklucHV0S2V5VXApO1xuICAgIH1cbiAgfVxuXG4gIG9wZW4gKGNhbGxiYWNrLCAgZGF0YSA9IHt9KSB7XG4gICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgIGNvbnN0ICRtb2RhbFRpdGxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLXRpdGxlJyk7XG5cbiAgICBpZiAoZGF0YS5pZCkge1xuICAgICAgJG1vZGFsVGl0bGUuaW5uZXJIVE1MID0gJ0VkaXQgVGFzayc7XG4gICAgfSBlbHNlIHtcbiAgICAgICRtb2RhbFRpdGxlLmlubmVySFRNTCA9ICdDcmVhdGUgVGFzayc7XG4gICAgfVxuXG4gICAgdGhpcy5jcmVhdGVUYXNrRm9ybShkYXRhKTtcblxuICAgIHRoaXMuJHJvb3RDb21wb25lbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gIH1cblxuICBjbG9zZSAoKSB7XG4gICAgdGhpcy5jYWxsYmFjayA9IG51bGw7XG4gICAgdGhpcy4kcm9vdENvbXBvbmVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICB9XG5cbiAgc2F2ZUZvcm0gKCkge1xuICAgIGNvbnN0IHRhc2tEYXRhID0ge307XG4gICAgY29uc3QgZm9ybUlucHV0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrLWZvcm0nKS5lbGVtZW50cztcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZm9ybUlucHV0cy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgeyBuYW1lLCB2YWx1ZSB9ID0gZm9ybUlucHV0c1tpXTtcbiAgICAgIHRhc2tEYXRhW25hbWVdID0gdmFsdWU7XG4gICAgfVxuXG4gICAgY29uc3QgdGFzayA9IG5ldyBUYXNrKHRhc2tEYXRhKTtcbiAgICBjb25zdCB7IGVycm9yLCBub3RWYWxpZEZpZWxkcywgdGFzazogbmV3VGFzayB9ID0gdGFzay5zYXZlKCk7XG5cbiAgICBpZiAoIWVycm9yKSB7XG4gICAgICB0aGlzLmNhbGxiYWNrICYmIHRoaXMuY2FsbGJhY2sobmV3VGFzayk7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZm9ybUlucHV0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCB7IG5hbWUgfSA9IGZvcm1JbnB1dHNbaV07XG5cbiAgICAgICAgdGhpcy5oaWdobGlnaHRJbnB1dChmb3JtSW5wdXRzW2ldLCBub3RWYWxpZEZpZWxkc1tuYW1lXSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgb25JbnB1dEtleVVwICh7IHRhcmdldCB9KSB7XG4gICAgY29uc3QgeyBuYW1lLCB2YWx1ZSB9ID0gdGFyZ2V0O1xuICAgIGNvbnN0IGlzVmFsaWQgPSBUYXNrLnZhbGlkYXRlRmllbGQobmFtZSwgdmFsdWUpO1xuXG4gICAgdGhpcy5oaWdobGlnaHRJbnB1dCh0YXJnZXQsIGlzVmFsaWQpO1xuICB9XG5cbiAgaGlnaGxpZ2h0SW5wdXQgKCRpbnB1dCwgaXNWYWxpZCkge1xuICAgIGlmICghaXNWYWxpZCkge1xuICAgICAgJGlucHV0LmNsYXNzTmFtZSA9IGAkeyRpbnB1dC5jbGFzc05hbWV9ICR7RVJST1JfQ0xBU1NfTkFNRX1gO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgICRpbnB1dC5jbGFzc0xpc3QucmVtb3ZlKEVSUk9SX0NMQVNTX05BTUUpO1xuICB9XG5cbn1cblxuY29uc3QgbW9kYWxDb250cm9sbGVyID0gbmV3IEZvcm1Nb2RhbCgpO1xuXG5leHBvcnQgZGVmYXVsdCBtb2RhbENvbnRyb2xsZXI7XG4iLCJpbXBvcnQgbW9kYWxDb250cm9sbGVyIGZyb20gJy4vbW9kYWwnO1xuaW1wb3J0IHN0b3JhZ2VTZXJ2aWNlIGZyb20gJy4vbG9jYWxTdG9yYWdlU2VydmljZSc7XG5pbXBvcnQgeyBjYXBpdGFsaXplLCBkZWJvdW5jZSwgY291bnRBY3RpdmVUYXNrcyB9IGZyb20gJy4vdXRpbHMnO1xuXG5cbmNvbnN0IG1haW5BY3Rpb25zQmxvY2tJZCA9ICdtYWluLXBhZ2VfX2FjdGlvbnMnO1xuY29uc3QgYWRkQnV0dG9uQ2xhc3MgPSAnYWRkLXRhc2snO1xuY29uc3QgZmluaXNoQWxsQnV0dG9uQ2xhc3MgPSAnZmluaXNoLWFsbC10YXNrcyc7XG5jb25zdCByZW1vdmVBbGxCdXR0b25DbGFzcyA9ICdyZW1vdmUtYWxsLXRhc2tzJztcblxuLy8gRmlsdGVycyBidXR0b25zXG5jb25zdCB0YXNrVHlwZVNlbGVjdElkID0gJ2ZpbHRlcnNfX3Rhc2stdHlwZSc7XG5jb25zdCBpbnB1dEZpbHRlcklkID0gJ2ZpbHRlcnNfX3NlYXJjaCc7XG5jb25zdCBmaWx0ZXJCdXR0b25zQmxvY2tJZCA9ICdmaWx0ZXJzX19idXR0b25zJztcbmNvbnN0IGZpbHRlckJ1dHRvbnNDbGFzc2VzID0ge1xuICBhbGw6ICdhbGwnLFxuICBvcGVuZWQ6ICdvcGVuZWQnLFxuICBjb21wbGV0ZWQ6ICdjb21wbGV0ZWQnLFxufTtcblxuY29uc3QgbGlzdEJsb2NrSWQgPSAndGFza3MtbGlzdCc7XG5cbmNsYXNzIFRhc2tMaXN0IHtcbiAgY29uc3RydWN0b3IgKHRhc2tzKSB7XG4gICAgdGhpcy50YXNrcyA9IHRhc2tzO1xuXG4gICAgdGhpcy5maWx0ZXJzU3RhdGUgPSB7XG4gICAgICBzdGF0dXM6IGZpbHRlckJ1dHRvbnNDbGFzc2VzLmFsbCxcbiAgICAgIHR5cGU6ICdhbGwnLFxuICAgICAgdGV4dDogJycsXG4gICAgfTtcblxuICAgIHRoaXMuaW5pdENvbW1vblN0cnVjdHVyZSgpO1xuXG4gICAgdGhpcy4kbWFpbkFjdGlvbnNCbG9jayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1haW5BY3Rpb25zQmxvY2tJZCk7XG4gICAgdGhpcy4kdGFza1R5cGVTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YXNrVHlwZVNlbGVjdElkKTtcbiAgICB0aGlzLiRpbnB1dEZpbHRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlucHV0RmlsdGVySWQpO1xuICAgIHRoaXMuJGZpbHRlckJ1dHRvbnNCbG9jayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZpbHRlckJ1dHRvbnNCbG9ja0lkKTtcbiAgICB0aGlzLiRsaXN0QmxvY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0QmxvY2tJZCk7XG4gICAgdGhpcy4kdGFza0NvdW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rhc2tzLWNvdW50Jyk7XG5cbiAgICB0aGlzLm9uQ2xpY2tGaWx0ZXJCdXR0b25zID0gdGhpcy5vbkNsaWNrRmlsdGVyQnV0dG9ucy5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25DaGFuZ2VUeXBlID0gdGhpcy5vbkNoYW5nZVR5cGUuYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uSW5wdXQgPSB0aGlzLm9uSW5wdXQuYmluZCh0aGlzKTtcbiAgICB0aGlzLnJlbmRlclRhc2tzID0gdGhpcy5yZW5kZXJUYXNrcy5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25UYXNrQ2hhbmdlID0gdGhpcy5vblRhc2tDaGFuZ2UuYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uQ3JlYXRlVGFzayA9IHRoaXMub25DcmVhdGVUYXNrLmJpbmQodGhpcyk7XG5cbiAgICB0aGlzLm9uRWRpdFRhc2sgPSB0aGlzLm9uRWRpdFRhc2suYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uQ2xpY2tNYWluQWN0aW9ucyA9IHRoaXMub25DbGlja01haW5BY3Rpb25zLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vbkNsaWNrRmlsdGVyQnV0dG9ucyA9IHRoaXMub25DbGlja0ZpbHRlckJ1dHRvbnMuYmluZCh0aGlzKTtcblxuICAgIHRoaXMucmVuZGVyVGFza3ModGhpcy50YXNrcyk7XG4gICAgdGhpcy5pbml0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIGluaXRDb21tb25TdHJ1Y3R1cmUgKCkge1xuICAgIGNvbnN0IHsgc3RhdHVzIH0gPSB0aGlzLmZpbHRlcnNTdGF0ZTtcbiAgICBjb25zdCAkbWFpbkJsb2NrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwcCcpO1xuICAgIGNvbnN0ICR0YXNrTGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXG4gICAgJHRhc2tMaXN0LmNsYXNzTmFtZSA9ICd0YXNrLWxpc3QtY29udGFpbmVyJztcbiAgICAkdGFza0xpc3QuaWQgPSAndGFzay1saXN0LWNvbnRhaW5lcic7XG4gICAgJHRhc2tMaXN0LmlubmVySFRNTCA9IGBcbiAgICAgIDxkaXYgaWQ9JHttYWluQWN0aW9uc0Jsb2NrSWR9IGNsYXNzPSR7bWFpbkFjdGlvbnNCbG9ja0lkfT5cblx0XHQ8YnV0dG9uIGNsYXNzPVwiYnV0dG9uICR7YWRkQnV0dG9uQ2xhc3N9XCI+QWRkPC9idXR0b24+XG5cdFx0PGJ1dHRvbiBjbGFzcz1cImJ1dHRvbiAke2ZpbmlzaEFsbEJ1dHRvbkNsYXNzfVwiPkZpbmlzaCBhbGw8L2J1dHRvbj5cblx0XHQ8YnV0dG9uIGNsYXNzPVwiYnV0dG9uICR7cmVtb3ZlQWxsQnV0dG9uQ2xhc3N9XCI+UmVtb3ZlIGFsbDwvYnV0dG9uPlxuXHQ8L2Rpdj5cblxuXHQ8ZGl2IGNsYXNzPVwiZmlsdGVyc1wiPlxuXHRcdDxkaXYgY2xhc3M9XCJmaWx0ZXJzX190eXBlc1wiPlxuXHRcdFx0PHNlbGVjdCBjbGFzcz1cInRhc2stdHlwZXNcIiBpZD0ke3Rhc2tUeXBlU2VsZWN0SWR9IG5hbWU9XCJ0eXBlXCI+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImFsbFwiPlxuICAgICAgICAgICAgYWxsXG4gICAgICAgICAgPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImxlYXJuaW5nXCI+XG4gICAgICAgICAgXHRsZWFybmluZ1xuICAgICAgICAgIDwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJzaG9wcGluZ1wiPlxuICAgICAgICAgICAgc2hvcHBpbmdcbiAgICAgICAgICA8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwidHJhdmVsaW5nXCI+XG4gICAgICAgICAgICB0cmF2ZWxpbmdcbiAgICAgICAgICA8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwic3BvcnRcIj5cbiAgICAgICAgICAgIHNwb3J0XG4gICAgICAgICAgPC9vcHRpb24+XG4gICAgICAgIDwvc2VsZWN0PlxuICAgICAgICBcdDxzcGFuIGlkPVwidGFza3MtY291bnRcIiBjbGFzcz1cInRhc2tzLWNvdW50XCI+JHt0aGlzLnRhc2tzLmxlbmd0aH0gVGFza3MgbGVmdDwvc3Bhbj5cblx0XHQ8L2Rpdj5cblxuXHRcdDxkaXYgaWQ9JHtmaWx0ZXJCdXR0b25zQmxvY2tJZH0gY2xhc3M9JHtmaWx0ZXJCdXR0b25zQmxvY2tJZH0+XG5cdFx0XHQ8YnV0dG9uIGNsYXNzPVwiYnV0dG9uICR7ZmlsdGVyQnV0dG9uc0NsYXNzZXMuYWxsfSBcbiAgICAgICAgICAke3N0YXR1cyA9PT0gZmlsdGVyQnV0dG9uc0NsYXNzZXMuYWxsID8gJ2FjdGl2ZScgOiAnJ31cIlxuICAgICAgPkFsbDwvYnV0dG9uPlxuXHRcdFx0PGJ1dHRvbiBjbGFzcz1cImJ1dHRvbiAke2ZpbHRlckJ1dHRvbnNDbGFzc2VzLm9wZW5lZH0gXG4gICAgICAgICAgJHtzdGF0dXMgPT09IGZpbHRlckJ1dHRvbnNDbGFzc2VzLm9wZW5lZCA/ICdhY3RpdmUnIDogJyd9XCJcbiAgICAgID5PcGVuZWQ8L2J1dHRvbj5cblx0XHRcdDxidXR0b24gY2xhc3M9XCJidXR0b24gJHtmaWx0ZXJCdXR0b25zQ2xhc3Nlcy5jb21wbGV0ZWR9IFxuICAgICAgICAke3N0YXR1cyA9PT0gZmlsdGVyQnV0dG9uc0NsYXNzZXMuY29tcGxldGVkID8gJ2FjdGl2ZScgOiAnJ31cIlxuICAgICAgPkNvbXBsZXRlZDwvYnV0dG9uPlxuXHRcdDwvZGl2PlxuXHQ8L2Rpdj5cblxuXHQ8aW5wdXQgY2xhc3M9XCJzZWFyY2hcIiBwbGFjZWhvbGRlcj1cInNlYXJjaFwiIGlkPSR7aW5wdXRGaWx0ZXJJZH0+XG5cblx0PGRpdiBjbGFzcz0ke2xpc3RCbG9ja0lkfSBpZD0ke2xpc3RCbG9ja0lkfT5cblx0XG4gIDwvZGl2PlxuICBgO1xuXG4gICAgJG1haW5CbG9jay5hcHBlbmRDaGlsZCgkdGFza0xpc3QpO1xuICB9XG5cbiAgaW5pdEV2ZW50TGlzdGVuZXJzICgpIHtcbiAgICB0aGlzLiRtYWluQWN0aW9uc0Jsb2NrLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbkNsaWNrTWFpbkFjdGlvbnMpO1xuICAgIHRoaXMuJGZpbHRlckJ1dHRvbnNCbG9jay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsXG4gICAgICB0aGlzLm9uQ2xpY2tGaWx0ZXJCdXR0b25zKTtcbiAgICB0aGlzLiR0YXNrVHlwZVNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB0aGlzLm9uQ2hhbmdlVHlwZSk7XG4gICAgdGhpcy4kaW5wdXRGaWx0ZXIuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBkZWJvdW5jZSh0aGlzLm9uSW5wdXQpKTtcbiAgICB0aGlzLiRsaXN0QmxvY2suYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uVGFza0NoYW5nZSk7XG4gIH1cblxuICBjcmVhdGVUYXNrRWxlbWVudCAoeyBpZCwgdGl0bGUsIGRlc2NyaXB0aW9uLCBzdGF0dXMgfSkge1xuICAgIGNvbnN0ICR0YXNrSXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICR0YXNrSXRlbS5jbGFzc0xpc3QuYWRkKCd0YXNrLWl0ZW0nLCBzdGF0dXMpO1xuICAgICR0YXNrSXRlbS5pZCA9IGlkO1xuXG4gICAgY29uc3QgJGNoZWNrYm94QmxvY2sgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICAgICRjaGVja2JveEJsb2NrLmNsYXNzTmFtZSA9ICdjaGVja2JveC1jb250YWluZXInO1xuICAgIGNvbnN0ICRjaGVja2JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgJGNoZWNrYm94LnNldEF0dHJpYnV0ZSgndHlwZScsICdjaGVja2JveCcpO1xuICAgIHN0YXR1cyA9PT0gZmlsdGVyQnV0dG9uc0NsYXNzZXMuY29tcGxldGVkICYmICRjaGVja2JveC5zZXRBdHRyaWJ1dGUoJ2NoZWNrZWQnLCB0cnVlKTtcbiAgICBjb25zdCAkc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAkc3Bhbi5jbGFzc05hbWUgPSAnY2hlY2ttYXJrJztcbiAgICAkY2hlY2tib3hCbG9jay5hcHBlbmRDaGlsZCgkY2hlY2tib3gpO1xuICAgICRjaGVja2JveEJsb2NrLmFwcGVuZENoaWxkKCRzcGFuKTtcblxuICAgIGNvbnN0ICR0ZXh0QmxvY2sgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAkdGV4dEJsb2NrLmNsYXNzTGlzdC5hZGQoJ3Rhc2stdGV4dCcpO1xuICAgICR0ZXh0QmxvY2suaW5uZXJIVE1MID0gYFxuICAgICAgICA8ZGl2IGNsYXNzPVwidGFzay10ZXh0X190aXRsZVwiPiR7Y2FwaXRhbGl6ZSh0aXRsZSl9PC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJ0YXNrLXRleHRfX2Rlc2NyaXB0aW9uXCI+JHtjYXBpdGFsaXplKGRlc2NyaXB0aW9uKX08L2Rpdj4gIFxuICAgICAgYDtcblxuICAgIGNvbnN0ICRhY3Rpb25zQmxvY2sgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAkYWN0aW9uc0Jsb2NrLmNsYXNzTmFtZSA9ICd0YXNrLWFjdGlvbnMnO1xuICAgICRhY3Rpb25zQmxvY2suaW5uZXJIVE1MID0gYFxuICAgICAgICA8aSBjbGFzcz1cImZhIGZhLXBlbmNpbCB0YXNrLWFjdGlvbnNfX2J1dHRvbiB0YXNrLWFjdGlvbnNfX2VkaXRcIj48L2k+XG4gICAgICAgIDxpIGNsYXNzPVwiZmEgZmEtdHJhc2ggdGFzay1hY3Rpb25zX19idXR0b24gdGFzay1hY3Rpb25zX19yZW1vdmVcIj48L2k+IFxuICAgICAgYDtcblxuICAgICR0YXNrSXRlbS5hcHBlbmRDaGlsZCgkY2hlY2tib3hCbG9jayk7XG4gICAgJHRhc2tJdGVtLmFwcGVuZENoaWxkKCR0ZXh0QmxvY2spO1xuICAgICR0YXNrSXRlbS5hcHBlbmRDaGlsZCgkYWN0aW9uc0Jsb2NrKTtcblxuICAgIHJldHVybiAkdGFza0l0ZW07XG4gIH1cblxuICByZW5kZXJUYXNrcyAoKSB7XG4gICAgY29uc3QgeyBzdGF0dXMsIHR5cGUsIHRleHQgfSA9IHRoaXMuZmlsdGVyc1N0YXRlO1xuICAgIGNvbnN0IHRhc2tzID0gdGhpcy50YXNrcy5maWx0ZXIodGFzayA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgIChzdGF0dXMgIT09ICdhbGwnICYmIHRhc2suc3RhdHVzICE9PSBzdGF0dXMpXG4gICAgICAgIHx8ICh0eXBlICE9PSAnYWxsJyAmJiB0YXNrLnR5cGUgIT09IHR5cGUpXG4gICAgICAgIHx8ICh0ZXh0ICYmIHRhc2sudGl0bGUudG9Mb3dlckNhc2UoKS5pbmRleE9mKHRleHQudG9Mb3dlckNhc2UoKSkgPT09IC0xXG4gICAgICAgICAgJiYgdGFzay5kZXNjcmlwdGlvbi50b0xvd2VyQ2FzZSgpLmluZGV4T2YodGV4dC50b0xvd2VyQ2FzZSgpKSA9PT0gLTEpXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KTtcblxuICAgIHRoaXMuJHRhc2tDb3VudC5pbm5lckhUTUwgPSBgJHtjb3VudEFjdGl2ZVRhc2tzKHRhc2tzKX0gVGFza3MgbGVmdGA7XG5cbiAgICBpZiAodGFza3MubGVuZ3RoKSB7XG4gICAgICB0YXNrcy5mb3JFYWNoKHRhc2tPYmogPT4ge1xuICAgICAgICBjb25zdCAkdGFza0l0ZW0gPSB0aGlzLmNyZWF0ZVRhc2tFbGVtZW50KHRhc2tPYmopO1xuICAgICAgICB0aGlzLiRsaXN0QmxvY2suYXBwZW5kQ2hpbGQoJHRhc2tJdGVtKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCAkbm9UYXNrcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XG4gICAgICAkbm9UYXNrcy5pbm5lckhUTUwgPSAnWW91IGhhdmVuXFwndCBhbnkgdGFza3MuJztcbiAgICAgICRub1Rhc2tzLmNsYXNzTmFtZSA9ICduby10YXNrcyc7XG5cbiAgICAgIHRoaXMuJGxpc3RCbG9jay5hcHBlbmRDaGlsZCgkbm9UYXNrcyk7XG4gICAgfVxuICB9XG5cbiAgb25DbGlja01haW5BY3Rpb25zICh7IHRhcmdldCB9KSB7XG4gICAgY29uc3QgaXNCdXR0b24gPSB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdidXR0b24nKTtcblxuICAgIGlmIChpc0J1dHRvbikge1xuICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoYWRkQnV0dG9uQ2xhc3MpKSB7XG4gICAgICAgIG1vZGFsQ29udHJvbGxlci5vcGVuKHRoaXMub25DcmVhdGVUYXNrKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoZmluaXNoQWxsQnV0dG9uQ2xhc3MpKSB7XG4gICAgICAgIGNvbnN0IGZpbmlzaGVkVGFza3MgPSB0aGlzLnRhc2tzLm1hcCh0YXNrID0+ICh7XG4gICAgICAgICAgLi4udGFzayxcbiAgICAgICAgICBzdGF0dXM6IGZpbHRlckJ1dHRvbnNDbGFzc2VzLmNvbXBsZXRlZCxcbiAgICAgICAgfSkpO1xuXG4gICAgICAgIHN0b3JhZ2VTZXJ2aWNlLnNldChmaW5pc2hlZFRhc2tzKTtcbiAgICAgICAgdGhpcy50YXNrcyA9IGZpbmlzaGVkVGFza3M7XG4gICAgICAgIHRoaXMuJGxpc3RCbG9jay5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgdGhpcy5yZW5kZXJUYXNrcygpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhyZW1vdmVBbGxCdXR0b25DbGFzcykpIHtcbiAgICAgICAgc3RvcmFnZVNlcnZpY2UuY2xlYXIoKTtcbiAgICAgICAgdGhpcy50YXNrcyA9IFtdO1xuICAgICAgICB0aGlzLiRsaXN0QmxvY2suaW5uZXJIVE1MID0gJyc7XG4gICAgICAgIHRoaXMucmVuZGVyVGFza3MoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBvbkNyZWF0ZVRhc2sgKHRhc2spIHtcbiAgICB0aGlzLiRsaXN0QmxvY2suaW5uZXJIVE1MID0gJyc7XG4gICAgdGhpcy50YXNrcy5wdXNoKHRhc2spO1xuICAgIHRoaXMucmVuZGVyVGFza3MoKTtcbiAgfVxuXG4gIG9uRWRpdFRhc2sgKCR0YXNrKSB7XG4gICAgcmV0dXJuIHRhc2sgPT4ge1xuICAgICAgY29uc3QgJG5ld1Rhc2sgPSB0aGlzLmNyZWF0ZVRhc2tFbGVtZW50KHRhc2spO1xuXG4gICAgICB0aGlzLnRhc2tzLnB1c2godGFzayk7XG4gICAgICB0aGlzLiRsaXN0QmxvY2sucmVwbGFjZUNoaWxkKCRuZXdUYXNrLCAkdGFzayk7XG4gICAgfTtcbiAgfVxuXG4gIG9uQ2xpY2tGaWx0ZXJCdXR0b25zICh7IHRhcmdldCB9KSB7XG4gICAgY29uc3QgcmVyZW5kZXJUYXNrcyA9IGZpbHRlclZhbHVlID0+IHtcbiAgICAgIHRoaXMuZmlsdGVyc1N0YXRlLnN0YXR1cyA9IGZpbHRlclZhbHVlO1xuICAgICAgdGhpcy4kbGlzdEJsb2NrLmlubmVySFRNTCA9ICcnO1xuICAgICAgdGhpcy5yZW5kZXJUYXNrcygpO1xuICAgIH07XG4gICAgY29uc3QgaXNCdXR0b24gPSB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdidXR0b24nKTtcbiAgICBjb25zdCBpc0NsaWNrZWRBY3RpdmVGaWx0ZXIgPSB0YXJnZXQuY2xhc3NMaXN0XG4gICAgICAuY29udGFpbnModGhpcy5maWx0ZXJzU3RhdGUuYnV0dG9uKTtcblxuXG4gICAgaWYgKGlzQnV0dG9uICYmICFpc0NsaWNrZWRBY3RpdmVGaWx0ZXIpIHtcbiAgICAgIGNvbnN0ICRwcmV2QWN0aXZlRmlsdGVyID0gW10uZmluZC5jYWxsKFxuICAgICAgICB0YXJnZXQucGFyZW50RWxlbWVudC5jaGlsZHJlbixcbiAgICAgICAgZWxlbSA9PiBlbGVtLmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJylcbiAgICAgICk7XG4gICAgICBjb25zdCBmaWx0ZXJWYWx1ZSA9IE9iamVjdC5rZXlzKGZpbHRlckJ1dHRvbnNDbGFzc2VzKVxuICAgICAgICAuZmluZCh2YWx1ZSA9PiB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKHZhbHVlKSk7XG5cbiAgICAgICRwcmV2QWN0aXZlRmlsdGVyLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuXG4gICAgICBmaWx0ZXJWYWx1ZSAmJiByZXJlbmRlclRhc2tzKGZpbHRlclZhbHVlKTtcbiAgICB9XG4gIH1cblxuICBvbkNoYW5nZVR5cGUgKHsgdGFyZ2V0OiB7IHZhbHVlIH0gfSkge1xuICAgIHRoaXMuZmlsdGVyc1N0YXRlLnR5cGUgPSB2YWx1ZTtcbiAgICB0aGlzLiRsaXN0QmxvY2suaW5uZXJIVE1MID0gJyc7XG4gICAgdGhpcy5yZW5kZXJUYXNrcygpO1xuICB9XG5cbiAgdXBkYXRlRmlsdGVycyAobmFtZSwgdmFsdWUpIHtcbiAgICB0aGlzLmZpbHRlcnNTdGF0ZVtuYW1lXSA9IHZhbHVlO1xuICAgIHRoaXMuJGxpc3RCbG9jay5pbm5lckhUTUwgPSAnJztcbiAgICB0aGlzLnJlbmRlclRhc2tzKCk7XG4gIH1cblxuICBvbklucHV0ICh7IHRhcmdldCB9KSB7XG4gICAgY29uc3QgdmFsdWUgPSB0YXJnZXQudmFsdWUudHJpbSgpO1xuICAgIHRoaXMudXBkYXRlRmlsdGVycygndGV4dCcsIHZhbHVlKTtcbiAgfVxuXG4gIG9uVGFza0NoYW5nZSAgKHsgdGFyZ2V0IH0pICB7XG4gICAgY29uc3QgeyB0YXNrcyB9ID0gdGhpcztcbiAgICBjb25zdCAkdGFzayA9IHRhcmdldC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQ7XG4gICAgY29uc3QgdGFza0lkID0gJHRhc2suaWQ7XG4gICAgY29uc3QgdGFza0FjdGlvbnMgPSB7XG4gICAgICByZW1vdmU6IHtcbiAgICAgICAgaXNDdXJyZW50OiB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCd0YXNrLWFjdGlvbnNfX3JlbW92ZScpLFxuICAgICAgICBydW46ICgpID0+IHtcbiAgICAgICAgICBjb25zdCBuZXdUYXNrcyA9IHRhc2tzLmZpbHRlcigoeyBpZCB9KSA9PiBpZCAhPT0gdGFza0lkKTtcblxuICAgICAgICAgIHN0b3JhZ2VTZXJ2aWNlLnNldChuZXdUYXNrcyk7XG4gICAgICAgICAgdGhpcy50YXNrcyA9IG5ld1Rhc2tzO1xuICAgICAgICAgIHRoaXMuJGxpc3RCbG9jay5yZW1vdmVDaGlsZCgkdGFzayk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBlZGl0OiB7XG4gICAgICAgIGlzQ3VycmVudDogdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygndGFzay1hY3Rpb25zX19lZGl0JyksXG4gICAgICAgIHJ1bjogKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHRhc2tPYmogPSB0YXNrcy5maW5kKCh7IGlkIH0pID0+IGlkID09PSB0YXNrSWQpO1xuXG4gICAgICAgICAgbW9kYWxDb250cm9sbGVyLm9wZW4odGhpcy5vbkVkaXRUYXNrKCR0YXNrKSwgdGFza09iaik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBjaGFuZ2VTdGF0dXM6IHtcbiAgICAgICAgaXNDdXJyZW50OiB0YXJnZXQudHlwZSA9PT0gJ2NoZWNrYm94JyxcbiAgICAgICAgcnVuOiAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgaXNDaGVja2VkID0gdGFyZ2V0LmNoZWNrZWQ7XG4gICAgICAgICAgY29uc3QgdGFza0luZGV4ID0gdGFza3MuZmluZEluZGV4KCh7IGlkIH0pID0+IGlkID09PSB0YXNrSWQpO1xuICAgICAgICAgIGNvbnN0IHRhc2sgPSB0aGlzLnRhc2tzW3Rhc2tJbmRleF07XG5cbiAgICAgICAgICBpZiAoaXNDaGVja2VkKSB7XG4gICAgICAgICAgICB0YXNrLnN0YXR1cyA9IGZpbHRlckJ1dHRvbnNDbGFzc2VzLmNvbXBsZXRlZDtcbiAgICAgICAgICAgICR0YXNrLmNsYXNzTGlzdC5hZGQoZmlsdGVyQnV0dG9uc0NsYXNzZXMuY29tcGxldGVkKTtcbiAgICAgICAgICAgICR0YXNrLmNsYXNzTGlzdC5yZW1vdmUoZmlsdGVyQnV0dG9uc0NsYXNzZXMub3BlbmVkKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGFzay5zdGF0dXMgPSBmaWx0ZXJCdXR0b25zQ2xhc3Nlcy5vcGVuZWQ7XG4gICAgICAgICAgICAkdGFzay5jbGFzc0xpc3QucmVtb3ZlKGZpbHRlckJ1dHRvbnNDbGFzc2VzLmNvbXBsZXRlZCk7XG4gICAgICAgICAgICAkdGFzay5jbGFzc0xpc3QuYWRkKGZpbHRlckJ1dHRvbnNDbGFzc2VzLm9wZW5lZCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy50YXNrc1t0YXNrSW5kZXhdID0gdGFzaztcbiAgICAgICAgICBzdG9yYWdlU2VydmljZS5zZXQodGhpcy50YXNrcyk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfTtcbiAgICBjb25zdCBhY3Rpb24gPSBPYmplY3QudmFsdWVzKHRhc2tBY3Rpb25zKS5maW5kKCh7IGlzQ3VycmVudCB9KSA9PiBpc0N1cnJlbnQpO1xuXG4gICAgaWYgKGFjdGlvbikge1xuICAgICAgYWN0aW9uLnJ1bigpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBUYXNrTGlzdDtcbiIsImltcG9ydCBzdG9yYWdlU2VydmljZSBmcm9tICcuL2xvY2FsU3RvcmFnZVNlcnZpY2UnO1xuaW1wb3J0IFRhc2tMaXN0IGZyb20gJy4vbWFpbic7XG5cbmltcG9ydCAnLi9zdHlsZXMvaW5kZXguc2Nzcyc7XG5cblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHtcbiAgY29uc3QgdGFza3MgPSBzdG9yYWdlU2VydmljZS5nZXQoKTtcblxuICBuZXcgVGFza0xpc3QodGFza3MpO1xufSk7XG4iXSwibWFwcGluZ3MiOiI7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDN0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNoR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDcE1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQzNVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///2\n")}]);